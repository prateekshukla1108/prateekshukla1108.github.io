<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <style>
        /* All your existing styles remain exactly the same */
        @import url('https://fonts.cdnfonts.com/css/sf-pro-display');

        :root {
            --dark-bg: #05040C;
            --dark-fg: #a8c1f2;
            --light-bg: #ffffff;
            --light-fg: #333333;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        /* ... (keeping all your existing styles) ... */

        /* Adding styles for individual post view */
        .single-post {
            backdrop-filter: blur(10px);
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        .single-post img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
        }

        .single-post-content {
            line-height: 1.8;
        }

        .single-post-content h1,
        .single-post-content h2,
        .single-post-content h3 {
            margin: 25px 0 15px;
        }

        .single-post-content p {
            margin-bottom: 15px;
        }

        .back-button {
            display: inline-block;
            color: inherit;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
        }

        .back-button:hover {
            background: var(--dark-fg);
            color: var(--dark-bg);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <a href="/" class="home-icon">
                    <i class="fas fa-home"></i>
                </a>
                <div class="theme-toggle">
                    <i class="fas fa-moon"></i>
                    <div class="toggle-slider">
                        <div class="slider-icon"></div>
                    </div>
                    <i class="fas fa-sun"></i>
                </div>
            </div>
            <div class="labels">
                <span class="label" data-tag="all">All</span>
                <span class="label" data-tag="AI">AI</span>
                <span class="label" data-tag="Philosophy">Philosophy</span>
                <span class="label" data-tag="Life">Life</span>
                <span class="label" data-tag="Neuroscience">Neuroscience</span>
            </div>
        </header>

        <main>
            <div id="content">
                <div class="posts">
                    <div class="loading">Loading posts...</div>
                </div>
            </div>
        </main>

        <footer>
            <div class="social-links">
                <a href="https://twitter.com/yourusername" target="_blank">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://github.com/yourusername" target="_blank">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </footer>
    </div>

    <script>
        // Global state
        let allPosts = [];
        let currentTag = 'all';

        // Theme Toggle
        const body = document.body;
        const themeToggle = document.querySelector('.toggle-slider');

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('light-mode');
            localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
        });

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            body.classList.add('light-mode');
        }

        // Handle navigation
        function handleNavigation() {
            const path = window.location.pathname;
            if (path === '/') {
                showPosts();
            } else if (path.startsWith('/blog/')) {
                const slug = path.split('/blog/')[1];
                showSinglePost(slug);
            }
        }

        // Show single post
        async function showSinglePost(slug) {
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = '<div class="loading">Loading post...</div>';

            try {
                // First, get the post metadata from posts.json
                const response = await fetch('/blog/posts.json');
                const data = await response.json();
                const postMeta = data.posts.find(post => post.slug === slug);

                if (!postMeta) {
                    throw new Error('Post not found');
                }

                // Then, fetch the actual post content
                const postResponse = await fetch(`/blog/posts/${slug}.md`);
                const postContent = await postResponse.text();

                contentDiv.innerHTML = `
                    <a href="/" class="back-button">
                        <i class="fas fa-arrow-left"></i> Back to Posts
                    </a>
                    <article class="single-post">
                        <div class="post-header">
                            ${postMeta.coverImage ? `<img src="${postMeta.coverImage}" alt="${postMeta.title}" class="post-cover">` : ''}
                            <h1 class="post-title">${postMeta.title}</h1>
                            <div class="post-meta">
                                <span class="post-date">
                                    <i class="far fa-calendar"></i>
                                    ${new Date(postMeta.date).toLocaleDateString()}
                                </span>
                                <span class="post-author">
                                    <i class="far fa-user"></i>
                                    ${postMeta.author}
                                </span>
                                <span class="post-reading-time">
                                    <i class="far fa-clock"></i>
                                    ${postMeta.readingTime}
                                </span>
                            </div>
                        </div>
                        <div class="post-tags">
                            ${postMeta.tags.map(tag => `
                                <span class="tag">${tag}</span>
                            `).join('')}
                        </div>
                        <div class="single-post-content">
                            ${marked.parse(postContent)}
                        </div>
                    </article>
                `;
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="error">
                        <p>Error loading post. Please try again later.</p>
                        <p>Error details: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Filter posts by tag
        function filterPosts(tag) {
            currentTag = tag;
            const filteredPosts = tag === 'all'
                ? allPosts
                : allPosts.filter(post => post.tags.includes(tag));
            displayPosts(filteredPosts);

            document.querySelectorAll('.label').forEach(label => {
                label.classList.toggle('active', label.dataset.tag === tag);
            });
        }

        // Display posts
        function displayPosts(posts) {
            const postsContainer = document.querySelector('.posts');

            if (posts.length === 0) {
                postsContainer.innerHTML = '<div class="error">No posts found</div>';
                return;
            }

            postsContainer.innerHTML = posts.map(post => `
                <article class="post">
                    <div class="post-header">
                        ${post.coverImage ? `<img src="${post.coverImage}" alt="${post.title}" class="post-cover">` : ''}
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-meta">
                            <span class="post-date">
                                <i class="far fa-calendar"></i>
                                ${new Date(post.date).toLocaleDateString()}
                            </span>
                            <span class="post-author">
                                <i class="far fa-user"></i>
                                ${post.author}
                            </span>
                            <span class="post-reading-time">
                                <i class="far fa-clock"></i>
                                ${post.readingTime}
                            </span>
                        </div>
                    </div>
                    <div class="post-tags">
                        ${post.tags.map(tag => `
                            <span class="tag" onclick="filterPosts('${tag}')">${tag}</span>
                        `).join('')}
                    </div>
                    <p class="post-excerpt">${post.excerpt}</p>
                    <a href="/blog/${post.slug}" class="read-more" onclick="showSinglePost('${post.slug}'); return false;">Read More</a>
                </article>
            `).join('');
        }

        // Show posts list
        async function showPosts() {
            try {
                const response = await fetch('/blog/posts.json');
                const data = await response.json();
                allPosts = data.posts;

                // Sort posts by date (newest first)
                allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

                // Display all posts initially
                filterPosts('all');

                // Add click handlers to labels
                document.querySelectorAll('.label').forEach(label => {
                    label.addEventListener('click', () => filterPosts(label.dataset.tag));
                });
            } catch (error) {
                console.error('Error loading blog posts:', error);
                document.querySelector('.posts').innerHTML = `
                    <div class="error">
                        <p>Error loading posts. Please try again later.</p>
                        <p>Error details: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Handle browser navigation
        window.addEventListener('popstate', handleNavigation);

        // Initial load
        document.addEventListener('DOMContentLoaded', handleNavigation);
    </script>
</body>
</html>
